<!DOCTYPE html>
<html lang="fr">
  <head>
    <link rel="icon" type="image/png" href="assets/favicon.png" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Transport ELZ ‚Äì Portail Employ√©s</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        font-family: "Comfortaa", sans-serif;
        background-color: #f8f8f8;
        color: #111;
      }

      .header {
        background-color: #111;
        padding: 20px;
        text-align: center;
      }

      .logo {
        height: 80px;
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 40px 20px;
      }

      h1 {
        font-size: 24px;
        margin-bottom: 40px;
        color: #111;
        text-align: center;
      }

      .btn-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 100%;
        max-width: 400px;
      }

      a.button {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px 20px;
        background: linear-gradient(135deg, #ff3b2f, #d31e15);
        border-radius: 12px;
        color: white;
        font-weight: 700;
        font-size: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }
      a.button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      }

      .button img {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        height: 36px;
        width: 36px;
      }

      .vacation-button {
        background-color: #ff281e !important;
        color: #ffffff !important;
      }

      .vacation-button:hover {
        background-color: #d31e15 !important;
      }

      .admin-popup {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999;
      }

      .admin-box {
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      }

      .admin-box input {
        padding: 12px;
        font-size: 18px;
        font-family: "Comfortaa", sans-serif;
        width: 100%;
        max-width: 200px;
        border: 1px solid #ccc;
        border-radius: 8px;
        margin-top: 10px;
      }

      .admin-box button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 16px;
        font-family: "Comfortaa", sans-serif;
        border: none;
        border-radius: 8px;
        background-color: #000;
        color: #fff;
        cursor: pointer;
      }

      footer {
        margin-top: 50px;
        padding: 20px 0 10px;
        font-size: 12px;
        color: #888;
        text-align: center;
      }

      .button.admin {
        background-color: #009688 !important; /* Teal ou autre couleur distinctive */
        color: #fff;
      }
      .button.admin:hover {
        background-color: #006e5e !important;
      }
    </style>
  </head>
  <body>
    <div class="header" id="header">
      <img src="assets/logo.jpeg" alt="Logo Transport ELZ" class="logo" />
    </div>

    <div class="container">
      <h1>Portail des employ√©s</h1>
      <div class="btn-container" id="liens">
        <a href="https://forms.gle/HECpkfwsGGcsdMVFA" class="button">
          <img src="assets/icones/feuille.png" alt="" /> Envoyer une feuille de
          temps
        </a>
        <a href="reparation.html" class="button">
          <img src="assets/icones/outil.png" alt="" /> Envoyer une demande de
          r√©paration
        </a>
        <a href="https://citernes.netlify.app/" class="button">
          <img src="assets/icones/camion.png" alt="" /> Disponibilit√© des
          √©quipements
        </a>
        <a href="fuel.html" class="button">
          <img src="assets/icones/fuel.png" alt="" /> Afficher le prix du diesel
        </a>
        <a href="poids.html" class="button">
          <img src="assets/icones/liste.png" alt="" /> Consulter la liste des
          charges
        </a>
        <!-- Le bouton admin va s'ajouter ici dynamiquement si l'employ√© est admin -->
      </div>

      <div
        id="section-talons"
        style="
          max-width: 400px;
          width: 100%;
          margin: 40px auto 0;
          display: none;
        "
      >
        <h2 style="text-align: center; font-size: 1.18em; margin-bottom: 20px">
          üìÇ Mes talons de paie
        </h2>
        <ul id="liste-talons" style="padding: 0; list-style: none"></ul>
      </div>

      <div style="margin-top: 30px">
        <button
          onclick="deconnexion()"
          style="
            background-color: #000;
            color: #fff;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            font-family: 'Comfortaa', sans-serif;
          "
        >
          Se d√©connecter
        </button>
      </div>
      <footer>Transport ELZ inc. ‚Äì Tous droits r√©serv√©s</footer>
    </div>

    <!-- ... le reste de ton HTML ... -->

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAxbpNoGfMEK5N6sy3WYWMTD3WGelff0QA",
        authDomain: "transportelz.firebaseapp.com",
        projectId: "transportelz",
        storageBucket: "transportelz.appspot.com",
        messagingSenderId: "290260714729",
        appId: "1:290260714729:web:a433a445eb44fe5404dc78",
        measurementId: "G-EKZYPTGFT7",
      };
      firebase.initializeApp(firebaseConfig);

      // Fonction globale pour le bouton de d√©connexion
      function deconnexion() {
        localStorage.removeItem("rememberTransportelz");
        localStorage.removeItem("roleTransportelz");
        localStorage.removeItem("identifiantTransportelz");
        localStorage.removeItem("nomTransportelz");
        window.location.href = "index.html";
      }

      document.addEventListener("DOMContentLoaded", async function () {
        // Affiche la section des fichiers apr√®s les boutons (tu dois avoir <div id="section-talons"> dans le HTML)
        const sectionTalons = document.getElementById("section-talons");
        const listeTalons = document.getElementById("liste-talons");

        // V√©rifier l'authentification via localStorage
        const remember = localStorage.getItem("rememberTransportelz");
        const role = localStorage.getItem("roleTransportelz");
        const identifiant = localStorage.getItem("identifiantTransportelz");
        const nom = localStorage.getItem("nomTransportelz");

        if (remember !== "true" || !role || !identifiant) {
          window.location.href = "index.html";
          return;
        }

        // Simuler l'objet user pour la compatibilit√©
        const user = {
          uid: identifiant,
          email: identifiant + "@transportelz.local"
        };

          if (role === "admin") {
            const btnContainer = document.getElementById("liens");
            const lienAdmin = document.createElement("a");
            lienAdmin.href = "admin.html";
            lienAdmin.className = "button admin";
            lienAdmin.innerHTML = `<img src="assets/icones/admin.png" alt=""> Administration`;
            btnContainer.insertBefore(lienAdmin, btnContainer.firstChild);
          }

          // ===== Affichage des fichiers "Mes talons de paie" =====
          if (sectionTalons && listeTalons) {
            sectionTalons.style.display = "block";
            listeTalons.innerHTML =
              "<li style='color:#888;text-align:center;'>Chargement‚Ä¶</li>";

            try {
              const querySnapshot = await firebase
                .firestore()
                .collection("docs")
                .where("uid", "==", identifiant)
                .orderBy("uploadedAt", "desc")
                .limit(4) // Affiche les 4 derniers fichiers
                .get();

              if (querySnapshot.empty) {
                listeTalons.innerHTML =
                  "<li style='color:#888;text-align:center;'>Aucun talon de paie pour le moment.</li>";
              } else {
                listeTalons.innerHTML = "";
                querySnapshot.forEach((doc) => {
                  const data = doc.data();
                  const li = document.createElement("li");
                  li.style =
                    "margin:0 0 12px 0;padding:14px 18px;background:#fff;border-radius:7px;box-shadow:0 2px 7px #0001;display:flex;align-items:center;justify-content:space-between;";
                  li.innerHTML = `
              <span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:220px;display:inline-block;">${data.filename}</span>
              <a href="${data.url}" download target="_blank" style="background:#009688;color:#fff;padding:6px 14px;border-radius:5px;text-decoration:none;font-size:15px;font-family:'Comfortaa',sans-serif;">T√©l√©charger</a>
            `;
                  listeTalons.appendChild(li);
                });
              }
            } catch (e) {
              listeTalons.innerHTML =
                "<li style='color:#e00;'>Erreur lors du chargement des fichiers.</li>";
            }
          }
          // ============================================
        });

        // Bouton de d√©connexion
        const btnDeconnexion = document.querySelector(
          "button[onclick='deconnexion()']"
        );
        if (btnDeconnexion) {
          btnDeconnexion.addEventListener("click", function (e) {
            e.preventDefault();
            // Nettoyer le localStorage
            localStorage.removeItem("rememberTransportelz");
            localStorage.removeItem("roleTransportelz");
            localStorage.removeItem("identifiantTransportelz");
            localStorage.removeItem("nomTransportelz");
            window.location.href = "index.html";
          });
        }
      });
    </script>
  </body>
</html>
