<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sommaire</title>
  <style>
    
    html, body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f4f4;
      font-size: 16px;
    }
    header {
  background-color: #111;
  width: 100vw;
  position: relative;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;
  padding: 10px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-sizing: border-box;
  z-index: 1000;
}

    header img {
      height: 40px;
    }
    .menu-toggle {
      display: flex;
      flex-direction: column;
      cursor: pointer;
    }
    .menu-toggle span {
      height: 3px;
      width: 25px;
      background: white;
      margin: 4px 0;
      transition: 0.3s;
    }
    .copy-btn {
  font-size: 12px;
  padding: 3px 6px;
  background-color: #555;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.copy-btn:hover {
  background-color: #333;
}

    .menu {
      display: none;
      position: absolute;
      top: 60px;
      right: 20px;
      background-color: #111;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 10px;
      z-index: 999;
    }
    .menu.show {
      display: block;
    }
    .equip-select {
  width: 100%;
  padding: 8px;
  font-size: 16px;
  font-family: 'Segoe UI', sans-serif;
  border: 2px solid #999;
  border-radius: 6px;
  background-color: #fff;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  appearance: none;
}

.equip-select:focus {
  outline: none;
  border-color: #d32f2f;
  box-shadow: 0 0 0 2px rgba(211, 47, 47, 0.2);
}

@media (max-width: 600px) {
  .equip-select {
    font-size: 18px;
    padding: 10px;
  }
}

    .menu a {
      display: block;
      color: white;
      padding: 8px 12px;
      text-decoration: none;
      font-size: 14px;
    }
    .menu a:hover {
      background-color: #333;
    }
    .container {
      padding: 20px;
      max-width: 1000px;
      margin: auto;
    }
    .top-bar {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
    }
    .top-bar input[type="date"] {
      padding: 8px 12px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
      box-sizing: border-box;
      font-size: 15px;
    }
    .table-wrapper {
      overflow-x: auto;
      margin-top: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    table {
      min-width: 900px;
      width: 100%;
      border-collapse: collapse;
    }
    td select {
  width: 100%;
  box-sizing: border-box;
}

    th, td {
  border: 1px solid #999;
  text-align: center;
  vertical-align: middle;
  padding: 6px;
  background-color: #fcfcfc;
}
th {
  background-color: #d32f2f;
  color: white;
  font-weight: bold;
  text-transform: uppercase;
}
tr:nth-child(even) td {
  background-color: #f7f7f7;
}
tr:nth-child(odd) td {
  background-color: #ffffff;
}

    }
    td[contenteditable] {
      outline: none;
      text-transform: uppercase;
    }
    .buttons {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .buttons button {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      color: white;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
    }
    .reset-btn { background-color: #e74c3c; }
    .save-btn { background-color: #2ecc71; }
    .send-btn { background-color: black; }
    .copy-btn {
      background-color: #555;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      body {
        padding: 0 12px 40px 12px;
      }
      .container {
        padding-left: 12px;
        padding-right: 12px;
      }
      .buttons {
        margin-bottom: 40px;
      }
      table {
        font-size: 13px;
      }
      th, td {
        padding: 6px;
        height: 32px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="assets/logo.jpeg" alt="Logo Transport ELZ">
    <div class="menu-toggle" onclick="document.getElementById('menuDropdown').classList.toggle('show')">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <div class="menu" id="menuDropdown">
      <a href="dispos.html">DisponibilitÃ©s</a>
      <a href="linktree.html">Menu</a>
    </div>
  </header>
  <div class="container">
    <div class="top-bar">
      <input type="date" id="dateSelect" />
    </div>
    <label for="note">Note:</label>
    <textarea id="note" rows="2"></textarea>
    <div class="table-wrapper">
      <table id="dispoTable">
  <thead>
    <tr>
      <th style="width:70px;">RANG</th>
      <th style="width:200px;">CLIENT</th>
      <th style="width:80px;">TYPE</th>
      <th style="width:80px;">DÃ‰PART</th>
      <th style="width:80px;">LIVRAISON</th>
      <th style="width:100px;">CHAUFFEUR</th>
      <th style="width:90px;">CAMION</th>
      <th style="width:100px;">REMORQUE</th>
      <th style="width:60px;">COPIE</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

    </div>
    <div class="buttons">
      <button class="reset-btn" onclick="resetForm()">Reset</button>
      <button class="save-btn" onclick="saveData()">Save</button>
      <button class="send-btn" onclick="sendForm()">Send</button>
    </div>
  </div>
  <script>
const camionOptions = ["", "1103", "1202", "1303", "1404", "1502", "1602", "1603", "1703", "1803"];
const remorqueOptions = ["", "1505", "1605", "1805", "1905", "1906", "2006", "2205", "2405", "2506", "2706"];

function createRow() {
  const row = document.createElement("tr");

  row.innerHTML = `
    <td contenteditable inputmode="numeric"></td>
    <td contenteditable></td>
    <td contenteditable></td>
    <td contenteditable></td>
    <td contenteditable></td>
    <td contenteditable></td>
    <td><select class="equip-select camion">${camionOptions.map(v => `<option>${v}</option>`).join('')}</select></td>
    <td><select class="equip-select remorque">${remorqueOptions.map(v => `<option>${v}</option>`).join('')}</select></td>
    <td><button class="copy-btn" onclick="copyRow(this)">ðŸ“‹</button></td>
  `;
  return row;
}

function generateDefaultRows(n = 9) {
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";
  for (let i = 0; i < n; i++) tbody.appendChild(createRow());
}

function saveData() {
  const table = document.getElementById("dispoTable");
  const rows = Array.from(table.querySelectorAll("tbody tr")).map(row =>
    Array.from(row.querySelectorAll("td")).map((td, i) => {
      if (i === 6 || i === 7) return td.querySelector("select")?.value || "";
      return td.textContent.trim();
    })
  );
  localStorage.setItem("dispo_rows", JSON.stringify(rows));
  localStorage.setItem("dispo_note", document.getElementById("note").value);
  localStorage.setItem("dispo_date", document.getElementById("dateSelect").value);
  alert("DonnÃ©es sauvegardÃ©es !");
}

function resetForm() {
  document.getElementById("note").value = "";
  document.getElementById("dateSelect").value = "";
  localStorage.clear();
  generateDefaultRows(9);
}

function sendForm() {
  const tableClone = document.getElementById("dispoTable").cloneNode(true);
  tableClone.querySelectorAll("td").forEach(td => {
    if (td.querySelector("select")) {
      const val = td.querySelector("select").value;
      td.innerText = val;
    } else if (td.hasAttribute("contenteditable")) {
      td.innerText = td.innerText.trim().toUpperCase();
    }
  });
  const data = {
    note: document.getElementById("note").value,
    date: document.getElementById("dateSelect").value,
    table: tableClone.outerHTML
  };
  fetch("https://script.google.com/macros/s/AKfycbyYx7yTmj4bnKtr6EvLf0qGSObYt0t6rs9xUEZ1q2ANniFoRDW-wP4etQ7kOMZSVgA_Xw/exec", {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });
  alert("DisponibilitÃ©s envoyÃ©es !");
}

function copyRow(button) {
  const row = button.closest("tr");
  const cells = row.querySelectorAll("td");
  const chauffeurMap = {
    "AP": { nom: "Audrey", tel: "4188737539" },
    "MD": { nom: "Mathieu", tel: "4183264730" },
    "RPE": { nom: "Raymond", tel: "4185550001" }
  };
  const rawCode = (cells[5]?.textContent || "").trim().toUpperCase();
  const chauffeur = chauffeurMap[rawCode] || { nom: rawCode, tel: "" };
  const values = [
    chauffeur.nom,
    cells[1].textContent.trim().toUpperCase(),
    cells[2].textContent.trim().toUpperCase(),
    cells[3].textContent.trim().toUpperCase(),
    cells[4].textContent.trim().toUpperCase(),
    cells[6].querySelector("select")?.value || "",
    cells[7].querySelector("select")?.value || ""
  ];
  const labels = ["Chauffeur", "Client", "Type", "DÃ©part", "Livraison", "Camion", "Remorque"];
  const dateStr = document.getElementById("dateSelect")?.value;
  const dateObj = new Date(dateStr);
  const jour = ["Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"][dateObj.getDay()];
  const mois = ["janvier", "fÃ©vrier", "mars", "avril", "mai", "juin", "juillet", "aoÃ»t", "septembre", "octobre", "novembre", "dÃ©cembre"][dateObj.getMonth()];
  const dateLabel = `${jour} le ${dateObj.getDate()} ${mois}`;
  let sms = `Salut,\nVoici ton voyage pour ${dateLabel}\n\n`;
  sms += labels.map((l, i) => `${l}: ${values[i]}`).join("\n");
  sms += "\n\nMerci !";
  const href = chauffeur.tel ? `sms:${chauffeur.tel}?body=${encodeURIComponent(sms)}` : `sms:?body=${encodeURIComponent(sms)}`;
  const link = document.createElement("a");
  link.href = href;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

window.onload = () => {
  const note = localStorage.getItem("dispo_note");
  const date = localStorage.getItem("dispo_date");
  const savedRows = JSON.parse(localStorage.getItem("dispo_rows") || "[]");
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";
  if (savedRows.length) {
    savedRows.forEach(data => {
      const row = createRow();
      const cells = row.querySelectorAll("td");
      data.forEach((val, i) => {
        if (i === 6 || i === 7) {
          cells[i].querySelector("select").value = val;
        } else {
          cells[i].textContent = val;
        }
      });
      tbody.appendChild(row);
    });
  } else generateDefaultRows();
  if (note) document.getElementById("note").value = note;
  if (date) document.getElementById("dateSelect").value = date;
};
</script>

</body>
</html>
